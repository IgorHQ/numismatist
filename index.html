<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Нумізмат: Повне Виправлення</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Segoe UI', sans-serif; color: white; }

        /* Меню вибору режиму */
        #menu { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .menu-btn { width: 280px; padding: 20px; margin: 10px; border-radius: 15px; border: 2px solid #f1c40f; background: #111; color: white; cursor: pointer; font-weight: bold; font-size: 18px; transition: 0.3s; }
        .menu-btn:hover { background: #f1c40f; color: black; }
        .menu-btn small { display: block; font-size: 12px; font-weight: normal; margin-top: 5px; color: #ccc; }

        /* Графічний інтерфейс */
        #ui-layer { display: none; }
        #top-bar { position: absolute; top: 15px; left: 15px; display: flex; gap: 15px; z-index: 100; }
        .stat { background: rgba(0,0,0,0.9); padding: 10px 20px; border-radius: 25px; border: 1px solid #f1c40f; font-weight: bold; }
        .gold { color: #f1c40f; } .blue { color: #3498db; }

        .main-nav { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; z-index: 100; }
        button { padding: 12px 25px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-blue { background: #3498db; color: white; }
        .btn-gold { background: #f1c40f; color: black; }
        .btn-album { background: #9b59b6; color: white; }
        button:disabled { opacity: 0.2; cursor: not-allowed; }

        /* Модальні вікна */
        #modal, #album-window {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #111; padding: 25px; border-radius: 25px; z-index: 1500; text-align: center;
            border: 2px solid #f1c40f; width: 320px; box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        #album-window { width: 380px; height: 500px; flex-direction: column; border-color: #9b59b6; }
        #album-list { flex: 1; overflow-y: auto; padding: 10px; }

        /* Контейнер для візуалізації монети */
        #coin-canvas-container { margin: 10px auto; width: 150px; height: 150px; position: relative; }
        canvas { border-radius: 50%; box-shadow: 0 0 20px rgba(241, 196, 15, 0.2); }

        .coin-row { background: #1a1a1a; margin-bottom: 8px; padding: 12px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #444; }
        .rare-anim { border-left-color: #e74c3c !important; animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .sell-small { background: #e74c3c; padding: 6px 10px; font-size: 11px; color: white; border-radius: 5px; }
    </style>
</head>
<body>

<div id="menu">
    <h1 style="color:#f1c40f">Нумізмат: Пошук Скарбів</h1>
    <button class="menu-btn" onclick="startGame('easy')">Простий <small>Пошук: 10₴ | Старт: 200₴</small></button>
    <button class="menu-btn" onclick="startGame('medium')">Середній <small>Пошук: 40₴ | Старт: 200₴</small></button>
    <button class="menu-btn" onclick="startGame('realism')">Реалізм <small>Пошук: 80₴ | Старт: 1000₴</small></button>
</div>

<div id="ui-layer">
    <div id="top-bar">
        <div class="stat">Гроші: <span id="money-val" class="gold">200</span>₴</div>
        <div class="stat">Досвід: <span id="xp-val" class="blue">0</span> XP</div>
    </div>

    <div id="modal">
        <h3 id="m-title" style="margin:0; color:#f1c40f">Знайдено монету</h3>
        
        <div id="coin-canvas-container">
            <canvas id="coinPreview" width="150" height="150"></canvas>
        </div>

        <div id="coin-desc" style="margin: 10px 0; line-height: 1.4;"></div>
        
        <div style="display:flex; gap:10px; justify-content:center">
            <button class="btn-blue" onclick="keepFound()">В альбом</button>
            <button style="background:#444; color:white;" onclick="sellFound()">Продати</button>
        </div>
    </div>

    <div id="album-window">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3>Ваш Альбом</h3>
            <button onclick="toggleAlbum()" style="background:none; color:red; border:none; font-size:24px; cursor:pointer;">×</button>
        </div>
        <div id="album-list"></div>
    </div>

    <div class="main-nav">
        <button id="work-btn" class="btn-blue" onclick="work()"></button>
        <button class="btn-gold" id="search-btn" onclick="search()"></button>
        <button class="btn-album" onclick="toggleAlbum()">Альбом</button>
    </div>
</div>

<script>
    let money = 200, xp = 0, myCoins = [], currentCoin = null;
    let config = {};

    const modes = {
        easy: { search: 10, work: 100, rareChance: 0.3, start: 200, gMin: 10 },
        medium: { search: 40, work: 60, rareChance: 0.15, start: 200, gMin: 5 },
        realism: { search: 80, work: 40, rareChance: 0.05, start: 1000, gMin: 1 }
    };

    function startGame(mode) {
        config = modes[mode];
        money = config.start;
        document.getElementById('menu').style.display = 'none';
        document.getElementById('ui-layer').style.display = 'block';
        document.getElementById('work-btn').innerText = `Працювати (+${config.work}₴)`;
        document.getElementById('search-btn').innerText = `Шукати (-${config.search}₴)`;
        updateUI();
    }

    // ФУНКЦІЯ МАЛЮВАННЯ МОНЕТИ
    function drawCoin(val, year) {
        const canvas = document.getElementById('coinPreview');
        const ctx = canvas.getContext('2d');
        const color = val >= 10 ? '#f1c40f' : '#dcdcdc'; // Золота або срібна

        // Очищення
        ctx.clearRect(0, 0, 150, 150);

        // Тіло монети
        const grad = ctx.createRadialGradient(75, 75, 10, 75, 75, 70);
        grad.addColorStop(0, color);
        grad.addColorStop(1, '#666');
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(75, 75, 70, 0, Math.PI * 2);
        ctx.fill();

        // Обідок
        ctx.strokeStyle = 'rgba(0,0,0,0.2)';
        ctx.lineWidth = 5;
        ctx.stroke();

        // Текст номіналу
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.textAlign = 'center';
        ctx.font = 'bold 50px Arial';
        ctx.fillText(val, 75, 80);

        // Текст року
        ctx.font = 'bold 16px serif';
        ctx.fillText(year, 75, 115);
        
        // Маленький підпис "коп"
        ctx.font = '12px Arial';
        ctx.fillText('коп.', 75, 95);
    }

    function search() {
        if (money < config.search) return;
        money -= config.search;

        const n = [1, 2, 5, 10, 25, 50][Math.floor(Math.random()*6)];
        const y = 1992 + Math.floor(Math.random()*32);
        const roll = Math.random();

        let isRare = roll < config.rareChance;
        let price = isRare ? 200 + Math.floor(Math.random()*500) : config.gMin + Math.floor(Math.random()*15);
        let name = isRare ? "РАРИТЕТ!" : "Звичайна монета";

        currentCoin = { n, y, price, name, rare: isRare };

        drawCoin(n, y); // Малюємо монету
        document.getElementById('m-title').innerText = name;
        document.getElementById('m-title').style.color = isRare ? '#e74c3c' : '#f1c40f';
        document.getElementById('coin-desc').innerHTML = `<b>${n} коп. ${y} року</b><br>Ціна: <span class="gold">${price} ₴</span>`;
        document.getElementById('modal').style.display = 'block';
        
        updateUI();
    }

    function work() { if(xp >= 8) { xp -= 8; money += config.work; updateUI(); } }
    function keepFound() { myCoins.push(currentCoin); xp += 10; closeModal(); }
    function sellFound() { money += currentCoin.price; closeModal(); }
    function closeModal() { document.getElementById('modal').style.display = 'none'; updateUI(); }

    function toggleAlbum() {
        const w = document.getElementById('album-window');
        w.style.display = (w.style.display==='flex')?'none':'flex';
        if(w.style.display==='flex') renderAlbum();
    }

    function renderAlbum() {
        const list = document.getElementById('album-list'); list.innerHTML = '';
        myCoins.forEach((c, i) => {
            const row = document.createElement('div');
            row.className = `coin-row ${c.rare?'rare-anim':''}`;
            row.innerHTML = `
                <div style="text-align:left"><b>${c.n} коп. ${c.y}</b><br><small>${c.name}</small></div>
                <button class="sell-small" onclick="sellFromAlbum(${i})">Продати за ${c.price}₴</button>`;
            list.appendChild(row);
        });
    }

    function sellFromAlbum(i) { money += myCoins[i].price; myCoins.splice(i, 1); renderAlbum(); updateUI(); }

    function updateUI() {
        document.getElementById('money-val').innerText = money;
        document.getElementById('xp-val').innerText = xp;
        document.getElementById('work-btn').disabled = xp < 8;
        document.getElementById('search-btn').disabled = money < config.search;
    }
</script>
</body>
</html>
